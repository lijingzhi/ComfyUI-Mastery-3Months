<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习进度仪表板 - ComfyUI精通计划</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/progress.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-chart-line"></i> 学习进度仪表板</h1>
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> 返回主门户
            </a>
        </div>
        
        <div class="dashboard">
            <!-- 总体进度 -->
            <div class="dashboard-card full-width">
                <h2><i class="fas fa-tasks"></i> 总体进度概览</h2>
                <div class="progress-section">
                    <div class="progress-circle">
                        <svg width="200" height="200">
                            <circle cx="100" cy="100" r="90" fill="none" stroke="#e0e0e0" stroke-width="20"/>
                            <circle cx="100" cy="100" r="90" fill="none" stroke="#4CAF50" stroke-width="20"
                                    stroke-linecap="round" stroke-dasharray="565.48" stroke-dashoffset="565.48" id="mainProgress"/>
                        </svg>
                        <div class="progress-text">
                            <span id="progressPercent">0%</span>
                            <small>已完成</small>
                        </div>
                    </div>
                    
                    <div class="progress-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="completedLessons">0</div>
                            <div class="stat-label">已完成课程</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalLessons">36</div>
                            <div class="stat-label">总课程数</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="daysRemaining">84</div>
                            <div class="stat-label">剩余天数</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="avgProgress">0%</div>
                            <div class="stat-label">日均进度</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 每周进度图表 -->
            <div class="dashboard-card">
                <h2><i class="fas fa-chart-bar"></i> 每周进度</h2>
                <div class="chart-container">
                    <canvas id="weeklyChart"></canvas>
                </div>
            </div>
            
            <!-- 学习时间分布 -->
            <div class="dashboard-card">
                <h2><i class="fas fa-clock"></i> 学习时间分布</h2>
                <div class="chart-container">
                    <canvas id="timeChart"></canvas>
                </div>
            </div>
            
            <!-- 最近完成的任务 -->
            <div class="dashboard-card">
                <h2><i class="fas fa-check-circle"></i> 最近完成</h2>
                <div class="recent-list" id="recentCompleted">
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>暂无完成记录</p>
                        <a href="weeks/week1/index.html" class="btn">开始第一课</a>
                    </div>
                </div>
            </div>
            
            <!-- 技能掌握情况 -->
            <div class="dashboard-card full-width">
                <h2><i class="fas fa-star"></i> 技能掌握情况</h2>
                <div class="skills-grid" id="skillsGrid">
                    <!-- 技能项将通过JS动态生成 -->
                </div>
            </div>
            
            <!-- 性能数据 -->
            <div class="dashboard-card full-width">
                <h2><i class="fas fa-tachometer-alt"></i> A3000性能数据</h2>
                <div class="performance-grid">
                    <div class="perf-item">
                        <div class="perf-label">显存使用峰值</div>
                        <div class="perf-value" id="peakVram">-- GB</div>
                        <div class="perf-bar">
                            <div class="perf-fill" id="vramBar"></div>
                        </div>
                    </div>
                    <div class="perf-item">
                        <div class="perf-label">平均渲染时间</div>
                        <div class="perf-value" id="avgRenderTime">-- 秒</div>
                        <div class="perf-bar">
                            <div class="perf-fill" id="renderBar"></div>
                        </div>
                    </div>
                    <div class="perf-item">
                        <div class="perf-label">GPU最高温度</div>
                        <div class="perf-value" id="maxTemp">-- °C</div>
                        <div class="perf-bar">
                            <div class="perf-fill" id="tempBar"></div>
                        </div>
                    </div>
                    <div class="perf-item">
                        <div class="perf-label">总生成图片</div>
                        <div class="perf-value" id="totalImages">0 张</div>
                        <div class="perf-bar">
                            <div class="perf-fill" id="imagesBar"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 学习建议 -->
            <div class="dashboard-card full-width">
                <h2><i class="fas fa-lightbulb"></i> 学习建议</h2>
                <div class="suggestions" id="suggestions">
                    <!-- 建议内容将通过JS动态生成 -->
                </div>
            </div>
        </div>
        
        <div class="actions">
            <button class="btn primary" onclick="exportReport()">
                <i class="fas fa-file-export"></i> 导出进度报告
            </button>
            <button class="btn" onclick="printDashboard()">
                <i class="fas fa-print"></i> 打印仪表板
            </button>
            <button class="btn" onclick="shareProgress()">
                <i class="fas fa-share-alt"></i> 分享进度
            </button>
        </div>
    </div>

    <script src="scripts/progress-tracker.js"></script>
    <script>
        // 初始化图表
        function initCharts() {
            // 每周进度图表
            const weeklyCtx = document.getElementById('weeklyChart').getContext('2d');
            const weeklyChart = new Chart(weeklyCtx, {
                type: 'bar',
                data: {
                    labels: ['第1周', '第2周', '第3周', '第4周', '第5周', '第6周'],
                    datasets: [{
                        label: '完成百分比',
                        data: [25, 0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(76, 175, 80, 0.7)',
                        borderColor: 'rgba(76, 175, 80, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // 学习时间图表
            const timeCtx = document.getElementById('timeChart').getContext('2d');
            const timeChart = new Chart(timeCtx, {
                type: 'doughnut',
                data: {
                    labels: ['基础练习', '项目实践', '理论学习', '问题解决'],
                    datasets: [{
                        data: [60, 20, 10, 10],
                        backgroundColor: [
                            '#4CAF50',
                            '#2196F3',
                            '#FF9800',
                            '#9C27B0'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // 更新进度数据
        function updateProgressData() {
            const completed = JSON.parse(localStorage.getItem('completedLessons') || '[]');
            const totalLessons = 36;
            const progress = Math.round((completed.length / totalLessons) * 100);
            
            // 更新总体进度
            document.getElementById('progressPercent').textContent = progress + '%';
            document.getElementById('completedLessons').textContent = completed.length;
            
            // 更新进度环
            const circle = document.getElementById('mainProgress');
            const circumference = 565.48;
            const offset = circumference - (progress / 100) * circumference;
            circle.style.strokeDashoffset = offset;
            
            // 更新最近完成列表
            updateRecentCompleted(completed);
            
            // 更新技能网格
            updateSkillsGrid();
            
            // 更新性能数据
            updatePerformanceData();
            
            // 更新学习建议
            updateSuggestions(progress);
        }
        
        // 更新最近完成列表
        function updateRecentCompleted(completed) {
            const container = document.getElementById('recentCompleted');
            
            if (completed.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>暂无完成记录</p>
                        <a href="weeks/week1/index.html" class="btn">开始第一课</a>
                    </div>
                `;
                return;
            }
            
            const recent = completed.slice(-5).reverse();
            container.innerHTML = recent.map(item => `
                <div class="recent-item">
                    <div class="recent-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="recent-content">
                        <div class="recent-title">${item.title || '未命名课程'}</div>
                        <div class="recent-date">${new Date(item.date).toLocaleDateString()}</div>
                    </div>
                    <div class="recent-time">${item.time || '--'}分钟</div>
                </div>
            `).join('');
        }
        
        // 更新技能网格
        function updateSkillsGrid() {
            const skills = [
                { id: 'setup', name: '环境安装', level: 1, max: 3 },
                { id: 'workflow', name: '工作流基础', level: 1, max: 5 },
                { id: 'prompt', name: '提示词工程', level: 0, max: 5 },
                { id: 'controlnet', name: 'ControlNet', level: 0, max: 5 },
                { id: 'animation', name: '动画制作', level: 0, max: 5 },
                { id: 'consistency', name: '一致性控制', level: 0, max: 5 },
                { id: 'audio', name: '音频同步', level: 0, max: 3 },
                { id: 'commercial', name: '商用制作', level: 0, max: 5 }
            ];
            
            const grid = document.getElementById('skillsGrid');
            grid.innerHTML = skills.map(skill => `
                <div class="skill-item">
                    <div class="skill-name">${skill.name}</div>
                    <div class="skill-level">
                        ${'★'.repeat(skill.level)}${'☆'.repeat(skill.max - skill.level)}
                    </div>
                    <div class="skill-progress">
                        <div class="skill-bar" style="width: ${(skill.level / skill.max) * 100}%"></div>
                    </div>
                </div>
            `).join('');
        }
        
        // 更新性能数据
        function updatePerformanceData() {
            const perf = JSON.parse(localStorage.getItem('a3000Performance') || '{}');
            
            document.getElementById('peakVram').textContent = (perf.peakVram || 0).toFixed(1) + ' GB';
            document.getElementById('avgRenderTime').textContent = (perf.avgRenderTime || 0).toFixed(1) + ' 秒';
            document.getElementById('maxTemp').textContent = (perf.maxTemp || 0) + ' °C';
            document.getElementById('totalImages').textContent = (perf.totalImages || 0) + ' 张';
            
            // 更新进度条
            document.getElementById('vramBar').style.width = Math.min((perf.peakVram || 0) / 12 * 100, 100) + '%';
            document.getElementById('renderBar').style.width = Math.max(100 - ((perf.avgRenderTime || 0) / 30 * 100), 0) + '%';
            document.getElementById('tempBar').style.width = Math.max(100 - ((perf.maxTemp || 0) / 85 * 100), 0) + '%';
            document.getElementById('imagesBar').style.width = Math.min((perf.totalImages || 0) / 100 * 100, 100) + '%';
        }
        
        // 更新学习建议
        function updateSuggestions(progress) {
            const suggestions = document.getElementById('suggestions');
            let html = '';
            
            if (progress < 10) {
                html = `
                    <div class="suggestion-item">
                        <i class="fas fa-rocket"></i>
                        <div>
                            <h3>刚刚开始！</h3>
                            <p>建议每天至少学习1小时，保持连续性。从基础工作流开始，不要急于求成。</p>
                        </div>
                    </div>
                `;
            } else if (progress < 30) {
                html = `
                    <div class="suggestion-item">
                        <i class="fas fa-fire"></i>
                        <div>
                            <h3>保持势头！</h3>
                            <p>基础已经掌握，开始尝试不同的模型和提示词组合。建议制作一个个人作品集。</p>
                        </div>
                    </div>
                `;
            }
            
            suggestions.innerHTML = html;
        }
        
        // 导出报告
        function exportReport() {
            const data = {
                progress: localStorage.getItem('completedLessons'),
                performance: localStorage.getItem('a3000Performance'),
                exportDate: new Date().toISOString(),
                reportType: 'comfyui-learning-progress'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `comfyui-progress-report-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // 打印仪表板
        function printDashboard() {
            window.print();
        }
        
        // 分享进度
        function shareProgress() {
            const progress = Math.round((JSON.parse(localStorage.getItem('completedLessons') || '[]').length / 36) * 100);
            const text = `我在ComfyUI三个月精通计划中已经完成了${progress}%的进度！`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ComfyUI学习进度',
                    text: text,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alert('进度已复制到剪贴板！');
                });
            }
        }
        
        // 页面加载
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            updateProgressData();
        });
    </script>
</body>
</html>